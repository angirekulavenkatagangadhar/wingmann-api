<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wingman - Add User</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <nav class="top-nav">
            <a href="/" class="nav-link active">Add User</a>
            <a href="/all-compatibility" class="nav-link">View All Compatibility</a>
            <a href="/api/json-data" class="nav-link" target="_blank">View JSON Data</a>
        </nav>
        <div class="header">
            <h1>Wingmann</h1>
            <p class="subtitle">Add New User</p>
        </div>

        <form id="compatibilityForm" class="form-container">
            <!-- Personal Information -->
            <div class="form-section">
                <h2>Personal Information</h2>
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
            </div>

            <!-- Questions -->
            <div class="questions-section">
                <h2>Compatibility Questions</h2>
                
                <!-- Question 1 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">1</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">How do you usually like to spend your weekends?</p>
                    <div class="options">
                        <label><input type="radio" name="q1" value="1" required> Relaxing at home</label>
                        <label><input type="radio" name="q1" value="2"> Going out with friends or exploring new places</label>
                        <label><input type="radio" name="q1" value="3"> Doing something productive</label>
                        <label><input type="radio" name="q1" value="4"> Mixing it up depending on my mood</label>
                    </div>
                </div>

                <!-- Question 2 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">2</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">When it comes to managing money as a couple, I prefer:</p>
                    <div class="options">
                        <label><input type="radio" name="q2" value="1" required> Putting it all together</label>
                        <label><input type="radio" name="q2" value="2"> Keeping our own accounts but being open about stuff</label>
                        <label><input type="radio" name="q2" value="3"> Splitting things in a way that feels fair for both</label>
                        <label><input type="radio" name="q2" value="4"> Keeping finances totally separate</label>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">3</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I feel most balanced when my partner and I have similar daily habits and energy levels.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q3" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q3" value="2"> 2</label>
                        <label><input type="radio" name="q3" value="3"> 3</label>
                        <label><input type="radio" name="q3" value="4"> 4</label>
                        <label><input type="radio" name="q3" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 4 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">4</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">If I had to choose between spending time on my goals or my relationship, I'd usually choose my goals.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q4" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q4" value="2"> 2</label>
                        <label><input type="radio" name="q4" value="3"> 3</label>
                        <label><input type="radio" name="q4" value="4"> 4</label>
                        <label><input type="radio" name="q4" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 5 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">5</span>
                        <span class="question-type">Descriptive</span>
                    </div>
                    <p class="question-text">What's one thing that really matters to you in a relationship? (For example: honesty, loyalty, respect)</p>
                    <textarea name="q5" id="q5" rows="3" placeholder="Your answer..." required></textarea>
                </div>

                <!-- Question 6 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">6</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">When I'm upset, I tend to:</p>
                    <div class="options">
                        <label><input type="radio" name="q6" value="1" required> Stay quiet and think</label>
                        <label><input type="radio" name="q6" value="2"> Talk things through right away</label>
                        <label><input type="radio" name="q6" value="3"> Distract myself until I feel calmer</label>
                        <label><input type="radio" name="q6" value="4"> Wait for the other person to reach out first</label>
                    </div>
                </div>

                <!-- Question 7 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">7</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">When you care about someone, you usually show it through:</p>
                    <div class="options">
                        <label><input type="radio" name="q7" value="1" required> Spending quality time together</label>
                        <label><input type="radio" name="q7" value="2"> Giving thoughtful gifts</label>
                        <label><input type="radio" name="q7" value="3"> Checking in and making sure they are okay</label>
                        <label><input type="radio" name="q7" value="4"> Doing things to help or support them</label>
                    </div>
                </div>

                <!-- Question 8 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">8</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I pick up on changes in someone's mood quickly.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q8" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q8" value="2"> 2</label>
                        <label><input type="radio" name="q8" value="3"> 3</label>
                        <label><input type="radio" name="q8" value="4"> 4</label>
                        <label><input type="radio" name="q8" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 9 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">9</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I can express how I feel even when it might cause disagreement.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q9" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q9" value="2"> 2</label>
                        <label><input type="radio" name="q9" value="3"> 3</label>
                        <label><input type="radio" name="q9" value="4"> 4</label>
                        <label><input type="radio" name="q9" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 10 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">10</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">When my partner withdraws during a disagreement, I usually want to reach out and reconnect.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q10" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q10" value="2"> 2</label>
                        <label><input type="radio" name="q10" value="3"> 3</label>
                        <label><input type="radio" name="q10" value="4"> 4</label>
                        <label><input type="radio" name="q10" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 11 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">11</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I sometimes worry that my partner might lose interest or drift away.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q11" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q11" value="2"> 2</label>
                        <label><input type="radio" name="q11" value="3"> 3</label>
                        <label><input type="radio" name="q11" value="4"> 4</label>
                        <label><input type="radio" name="q11" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 12 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">12</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I love emotional closeness, but too much of it can make me want space.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q12" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q12" value="2"> 2</label>
                        <label><input type="radio" name="q12" value="3"> 3</label>
                        <label><input type="radio" name="q12" value="4"> 4</label>
                        <label><input type="radio" name="q12" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 13 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">13</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">Even with someone I trust, I sometimes hold back my true feelings.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q13" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q13" value="2"> 2</label>
                        <label><input type="radio" name="q13" value="3"> 3</label>
                        <label><input type="radio" name="q13" value="4"> 4</label>
                        <label><input type="radio" name="q13" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 14 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">14</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">When I feel overwhelmed, I usually:</p>
                    <div class="options">
                        <label><input type="radio" name="q14" value="1" required> Take some time alone to recharge and think</label>
                        <label><input type="radio" name="q14" value="2"> Talk it out with someone I trust</label>
                        <label><input type="radio" name="q14" value="3"> Distract myself with music, shows, or hobbies</label>
                        <label><input type="radio" name="q14" value="4"> Try to stay busy and push through it</label>
                    </div>
                </div>

                <!-- Question 15 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">15</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">If someone you're dating doesn't text back for hours, what's your first reaction?</p>
                    <div class="options">
                        <label><input type="radio" name="q15" value="1" required> Calm - they're probably busy</label>
                        <label><input type="radio" name="q15" value="2"> Anxious - did I say something wrong?</label>
                        <label><input type="radio" name="q15" value="3"> Unbothered - I'll reply later too</label>
                        <label><input type="radio" name="q15" value="4"> Irritated - communication should be consistent</label>
                    </div>
                </div>

                <!-- Question 16 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">16</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I feel safe sharing my feelings when I know I won't be judged.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q16" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q16" value="2"> 2</label>
                        <label><input type="radio" name="q16" value="3"> 3</label>
                        <label><input type="radio" name="q16" value="4"> 4</label>
                        <label><input type="radio" name="q16" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 17 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">17</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">After a disagreement, I'm usually the one to take the first step toward making things right.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q17" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q17" value="2"> 2</label>
                        <label><input type="radio" name="q17" value="3"> 3</label>
                        <label><input type="radio" name="q17" value="4"> 4</label>
                        <label><input type="radio" name="q17" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 18 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">18</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">When conflict arises, I tend to:</p>
                    <div class="options">
                        <label><input type="radio" name="q18" value="1" required> Avoid it until things calm down</label>
                        <label><input type="radio" name="q18" value="2"> Address it right away</label>
                        <label><input type="radio" name="q18" value="3"> Compromise quickly to move on</label>
                        <label><input type="radio" name="q18" value="4"> Reflect before bringing it up</label>
                    </div>
                </div>

                <!-- Question 19 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">19</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I often focus more on being right than on being understood.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q19" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q19" value="2"> 2</label>
                        <label><input type="radio" name="q19" value="3"> 3</label>
                        <label><input type="radio" name="q19" value="4"> 4</label>
                        <label><input type="radio" name="q19" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 20 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">20</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I find it difficult to stay calm when I feel misunderstood.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q20" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q20" value="2"> 2</label>
                        <label><input type="radio" name="q20" value="3"> 3</label>
                        <label><input type="radio" name="q20" value="4"> 4</label>
                        <label><input type="radio" name="q20" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 21 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">21</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I believe relationships help both people grow.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q21" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q21" value="2"> 2</label>
                        <label><input type="radio" name="q21" value="3"> 3</label>
                        <label><input type="radio" name="q21" value="4"> 4</label>
                        <label><input type="radio" name="q21" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 22 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">22</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">When I realize I've hurt someone, I try to take responsibility and reconnect.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q22" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q22" value="2"> 2</label>
                        <label><input type="radio" name="q22" value="3"> 3</label>
                        <label><input type="radio" name="q22" value="4"> 4</label>
                        <label><input type="radio" name="q22" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 23 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">23</span>
                        <span class="question-type">Scale</span>
                    </div>
                    <p class="question-text">I rarely talk about my feelings and emotions.</p>
                    <div class="scale-options">
                        <label><input type="radio" name="q23" value="1" required> 1 - Completely Disagree</label>
                        <label><input type="radio" name="q23" value="2"> 2</label>
                        <label><input type="radio" name="q23" value="3"> 3</label>
                        <label><input type="radio" name="q23" value="4"> 4</label>
                        <label><input type="radio" name="q23" value="5"> 5 - Completely Agree</label>
                    </div>
                </div>

                <!-- Question 24 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">24</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">Which best describes how you feel about relationships right now?</p>
                    <div class="options">
                        <label><input type="radio" name="q24" value="1" required> Ready to build something meaningful</label>
                        <label><input type="radio" name="q24" value="2"> Open but cautious</label>
                        <label><input type="radio" name="q24" value="3"> Still exploring what I really want</label>
                        <label><input type="radio" name="q24" value="4"> Healing and taking things slow</label>
                    </div>
                </div>

                <!-- Question 25 -->
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">25</span>
                        <span class="question-type">MCQ</span>
                    </div>
                    <p class="question-text">I've learned the most about relationships from:</p>
                    <div class="options">
                        <label><input type="radio" name="q25" value="1" required> My past relationships</label>
                        <label><input type="radio" name="q25" value="2"> Watching family or friends</label>
                        <label><input type="radio" name="q25" value="3"> Personal growth and self reflection</label>
                        <label><input type="radio" name="q25" value="4"> Movies, books, or social media</label>
                    </div>
                </div>

            </div>

            <div class="submit-section">
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span>Add User</span>
                    <span class="loader" id="loader" style="display: none;"></span>
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('compatibilityForm');
            const submitBtn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                submitBtn.disabled = true;
                loader.style.display = 'inline-block';
                submitBtn.querySelector('span:first-child').textContent = 'Adding...';

                const formData = new FormData(form);
                const answers = {};
                
                const name = document.getElementById('name').value;
                const gender = document.getElementById('gender').value;
                const phone = document.getElementById('phone').value;

                for (let i = 1; i <= 25; i++) {
                    const qName = `q${i}`;
                    const value = formData.get(qName);
                    if (value) {
                        answers[i.toString()] = value;
                    }
                }

                if (Object.keys(answers).length !== 25) {
                    alert('Please answer all 25 questions before submitting.');
                    submitBtn.disabled = false;
                    loader.style.display = 'none';
                    submitBtn.querySelector('span:first-child').textContent = 'Add User';
                    return;
                }

                try {
                    const response = await fetch('/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: name,
                            gender: gender,
                            phone: phone,
                            answers: answers
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert(`User "${name}" added successfully!`);
                        form.reset();
                        submitBtn.disabled = false;
                        loader.style.display = 'none';
                        submitBtn.querySelector('span:first-child').textContent = 'Add User';
                        
                        if (window.parent !== window) {
                            window.parent.postMessage('userAdded', '*');
                        }
                    } else {
                        const errorMsg = data.error || 'An error occurred. Please try again.';
                        alert(`Error: ${errorMsg}`);
                        console.error('Server error:', data);
                        submitBtn.disabled = false;
                        loader.style.display = 'none';
                        submitBtn.querySelector('span:first-child').textContent = 'Add User';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert(`Error: ${error.message || 'An error occurred. Please try again.'}`);
                    submitBtn.disabled = false;
                    loader.style.display = 'none';
                    submitBtn.querySelector('span:first-child').textContent = 'Add User';
                }
            });
        });
    </script>
</body>
</html>

